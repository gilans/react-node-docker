version: "3"
services:
  traefik:
    image: traefik:latest # The official Traefik docker image
    command: --api --docker --logLevel=info # Enables the web UI and tells Traefik to listen to docker
    ports:
      - "80:80" # The HTTP port
      - "8080:8080" # The Web UI (enabled by --api)
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # So that Traefik can listen to the Docker events
  client:
    build: ./client
    environment:
      - REACT_APP_PORT=80
    expose:
      - 3000
    ports:
      - "3000:3000"
    volumes:
      - ./client:/client/src/app
    links:
      - "api:api"
    command: npm run start
    labels:
      - "traefik.frontend.rule=Host:client.docker.localhost"
  api:
    build: ./api
    expose:
      - 8000
    ports:
      - "8000:8000"
    environment:
      API_HOST: "http://localhost:3000/"
      APP_SERVER_PORT: 8000
    volumes:
      - ./api:/api
      - /api/node_modules
    command: npm run start
    labels:
      - "traefik.backend=api"
      - "traefik.frontend.rule=Host:api.docker.localhost"
